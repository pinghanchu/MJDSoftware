This document summarizes the procedure of calibration.
The DAQ shifter needs to do the following items:

0. Copy this package to your home and then "make" to compile the code.

1. Determine the run range [startrun,endrun] and the cover range [cover startrun, cover endrun] form elog or database.

2. Modify the file "runrange.txt".
[start run] [end run] [cover start run] [cover end run]
If you update the latest calibration runs, the [cover start run] is usually equal to the [start run], and the [cover end run] is 4999999.

3. Run the Step 1 of the script "submit.pl". 
This will run the script "calibration.pl" and do calibration. This script will submit jobs for the energy trapE, trapENF, trapENM of each detector. 
a. Check if $dataset is correct path for the gat data.
b. Comment out Step 2 and Step 3.
c. Check if all jobs are done. The path saving the output text files is "./List/[startrun]_[endrun]/". It includes "calibration_[startrun]_[endrun]_*.txt", "cov_[startrun]_[endrun]_*.txt", and "reso_[startrun]_[endrun]_*.txt". Qsub doesn't always finish jobs. After all jobs are done, re-run "submit.pl". Repeat this process few time until no job will be submitted.

4. Run teh Step 2 of the script "submit.pl".
This will generate a document "calibration_[start run]_[end run].pdf". It includes plots of fitted spectrum and the deviation of the linear fitting. 
a. Comment out Step 1 and Step 3.
b. Check if the peak fitting makes sense and the deviation is not too big from "calibration_[start run]_[end run].pdf". 
c. "./List/[startrun]_[endrun]/error_[startrun]_[endrun]_*.txt" show the channel has deviation larger than 0.5 keV.
d. If the fitting is too bad, inform the Energy On-Call Person (the default one is Pinghan Chu) and the DAQ group. This may imply the channel has a big issue.
  
5. Ask David Tedeschi to stop the run production, and modify the record in the database. 
a. Need to change the previous record from the cover range [run1, 4999999] to [run1, run2-1] where run2 is the current [start run].
(Robert Varnerrl is working on the script.)
b. Comment out Step 1 and Step 2.
c. Run the Step 3 of the script "submit.pl". This will upload the calibration parameters to the database. Ask for the username and password from Robert Varnerrl. 
